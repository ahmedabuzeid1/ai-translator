<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…ØªØ±Ø¬Ù… Ù…Ø­Ù„ÙŠ â€” Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ â‡„ Ø¹Ø±Ø¨ÙŠ (AI Ù…Ø­Ù„ÙŠ)</title>
  <style>
    :root{
      --bg:#0b1020; --card:#111936; --muted:#7b88a8; --accent:#66e0a3; --danger:#ff6b6b; --text:#e8eefb;
      --border:#1b254b; --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cairo,Arial,sans-serif;background:linear-gradient(180deg,#0b1020 0%,#0f1630 100%);color:var(--text)}
    .container{max-width:1100px;margin:auto;padding:24px}
    .header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin:8px 0 20px}
    .title{font-size:clamp(20px,2.4vw,28px);font-weight:800;letter-spacing:.2px}
    .subtitle{color:var(--muted);font-size:14px}
    .card{background:linear-gradient(180deg,#101a39 0%,#0f1936 100%);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:18px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    textarea{width:100%;height:280px;background:#0e1430;border:1px solid var(--border);border-radius:14px;padding:14px 14px 54px;color:var(--text);font-size:15px;line-height:1.8;resize:vertical;}
    textarea::placeholder{color:#7f8bb3}
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-top:12px}
    .controls .right{margin-inline-start:auto;display:flex;gap:10px}
    .btn{appearance:none;border:1px solid var(--border);background:#0e1736;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700;transition:.2s;box-shadow:0 2px 0 rgba(0,0,0,.2)}
    .btn:hover{transform:translateY(-1px);border-color:#2a3a7a}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn.primary{background:linear-gradient(90deg,#1e9d6e,#24c389);border-color:transparent;color:#08121a}
    .btn.ghost{background:transparent}
    .btn.danger{background:linear-gradient(90deg,#e05252,#ff7b7b);border-color:transparent;color:#2a0e0e}
    .swap{display:flex;align-items:center;gap:8px}
    select, .select-like{background:#0e1736;border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:12px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px dashed #2c3a74;border-radius:999px;color:#a8b3d1;font-size:12px}
    .status{margin-top:10px;color:#a8b3d1;font-size:13px;min-height:20px}
    .footer{display:flex;gap:10px;justify-content:space-between;align-items:center;margin-top:18px}
    .small{font-size:12px;color:#9fb0d6}
    .badge{font-size:11px;background:#13214a;color:#9cc3ff;padding:6px 10px;border-radius:999px;border:1px solid #1c2c5d}
    .stack{display:flex;gap:10px;flex-wrap:wrap}
    .progress{width:100%;height:8px;background:#0e1430;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#66e0a3,#9df0c5)}
    .corner{position:fixed;inset-inline-end:16px;inset-block-end:16px;opacity:.9}
    .link{color:#8be5ff;text-decoration:none}
    .tooltip{border-bottom:1px dotted #6272a4;cursor:help}
    .note{padding:10px 12px;background:#0f1a3a;border:1px solid #1b2a5a;border-radius:12px;color:#9fb0d6}
  </style>
  <!--
  ğŸ›ˆ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ù„Ù„ØªØ´ØºÙŠÙ„ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ Ø¥Ø¹Ø¯Ø§Ø¯:
  1) Ù†Ø²Ù‘Ù„ Ù…Ù„Ù Ø§Ù„Ù…ÙƒØªØ¨Ø© transformers.min.js ÙˆØ§Ø­ÙØ¸Ù‡ Ø¨Ø¬Ø§Ù†Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù.
     Ù…Ù† CDN Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ù… Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ù…Ø­Ù„ÙŠØ§Ù‹ (ØºÙŠÙ‘Ø± ÙˆØ³Ù… <script> Ø£Ø¯Ù†Ø§Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ).
  2) Ù†Ø²Ù‘Ù„ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨ØµÙŠØºØ© safetensors/onnx Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© Ù…Ù† transformers.js ÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ Ù…Ø¬Ù„Ø¯ models:
     - Helsinki-NLP/opus-mt-en-ar (ØªØ±Ø¬Ù…Ø© ENâ†’AR)
     - Helsinki-NLP/opus-mt-ar-en (ØªØ±Ø¬Ù…Ø© ARâ†’EN)
     Ø³Ù†Ø³ØªØ®Ø¯Ù… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ù…Ø³Ø§Ø±Ø§Øª Ù…Ø­Ù„ÙŠØ© (local files URLs) Ø¨Ø¯Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.
  3) Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„ØŒ ØªÙØ®Ø²Ù‘Ù† Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ IndexedDB ÙˆÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ù…Ù„ Ø£ÙˆÙÙ„Ø§ÙŠÙ† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.
  4) Ø¥Ù† ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ WebGPU Ø³ÙŠÙØ³ØªØ®Ø¯Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø£Ø¯Ø§Ø¡ØŒ ÙˆØ¥Ù„Ø§ ÙØ³ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ CPU.
  -->
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <div class="title">Ù…ØªØ±Ø¬Ù… Ù…Ø­Ù„ÙŠ (AI) â€” Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ â‡„ Ø¹Ø±Ø¨ÙŠ</div>
        <div class="subtitle">ÙŠØ¹Ù…Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ Ø¯ÙˆÙ† Ù…ÙØ§ØªÙŠØ­ API. Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ Ø³ÙŠØ¹Ù…Ù„ Ø¨Ù„Ø§ Ø¥Ù†ØªØ±Ù†Øª.</div>
      </div>
      <span class="badge">Ù†Ø³Ø®Ø© ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</span>
    </div>

    <div class="card">
      <div class="stack" style="justify-content:space-between;align-items:center;margin-bottom:12px">
        <div class="stack">
          <label class="select-like">Ø§Ù„Ø§ØªØ¬Ø§Ù‡:
            <select id="direction">
              <option value="en-ar">Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ â†’ Ø¹Ø±Ø¨ÙŠ</option>
              <option value="ar-en">Ø¹Ø±Ø¨ÙŠ â†’ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</option>
            </select>
          </label>
          <label class="select-like">Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:
            <select id="modelSelect">
              <option value="en-ar">Helsinki-NLP/opus-mt-en-ar</option>
              <option value="ar-en">Helsinki-NLP/opus-mt-ar-en</option>
            </select>
          </label>
          <span class="pill">Ø§Ù„ØªØ³Ø±ÙŠØ¹: <span id="accel">Ø§Ù„ØªØ­Ù‚Ù‚â€¦</span></span>
        </div>
        <button class="btn ghost" id="swapBtn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡">â‡„ ØªØ¨Ø¯ÙŠÙ„</button>
      </div>

      <div class="row">
        <div>
          <textarea id="src" placeholder="Ø§ÙƒØªØ¨/Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø£Ùˆ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©â€¦"></textarea>
          <div class="controls">
            <button class="btn" id="pasteBtn">Ù„ØµÙ‚</button>
            <button class="btn danger" id="clearBtn">Ù…Ø³Ø­</button>
            <div class="right">
              <button class="btn primary" id="translateBtn">ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¢Ù†</button>
            </div>
          </div>
        </div>
        <div>
          <textarea id="tgt" placeholder="Ø³ØªØ¸Ù‡Ø± Ø§Ù„ØªØ±Ø¬Ù…Ø© Ù‡Ù†Ø§â€¦" readonly></textarea>
          <div class="controls">
            <button class="btn" id="copyBtn">Ù†Ø³Ø® Ø§Ù„ØªØ±Ø¬Ù…Ø©</button>
            <button class="btn ghost" id="saveTxtBtn" title="Ø­ÙØ¸ ÙƒÙ…Ù„Ù Ù†ØµÙŠ">Ø­ÙØ¸ .txt</button>
          </div>
        </div>
      </div>

      <div class="footer">
        <div class="stack">
          <div class="note">
            <strong>ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„:</strong> <span id="mode">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬â€¦</span>
            <span class="tooltip" title="ØªÙ„Ù…ÙŠØ­: Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø¯Ù†Ø§Ù‡ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¨Ø· Ù…Ø³Ø§Ø± Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„ØªØ¹Ù…Ù„ Ø£ÙˆÙÙ„Ø§ÙŠÙ†.">ğŸ›ˆ</span>
          </div>
          <div class="note">
            <label>Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ù„Ù†Ù…Ø§Ø°Ø¬: <input id="localBase" placeholder="Ù…Ø«Ù„Ù‹Ø§: ./models/" style="width:240px;background:#0d1533;border:1px solid var(--border);border-radius:8px;color:var(--text);padding:6px 8px"></label>
            <button class="btn" id="applyLocal">ØªØ·Ø¨ÙŠÙ‚</button>
          </div>
        </div>
        <div style="min-width:220px">
          <div class="small" style="margin-bottom:6px">ØªÙ‚Ø¯Ù‘Ù… Ø§Ù„ØªØ­Ù…ÙŠÙ„</div>
          <div class="progress"><div class="bar" id="bar"></div></div>
          <div class="small" id="progressText"></div>
        </div>
      </div>
      <div class="status" id="status"></div>
    </div>

    <p class="small" style="margin-top:14px">Ø¥Ù† Ø¸Ù‡Ø± Ø¨Ø·Ø¡ ÙÙŠ Ø£ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙ‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ Ø¨Ø³Ø¨Ø¨ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©. Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ Ø³ØªØ¹Ù…Ù„ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¨Ø³Ø±Ø¹Ø©.
      ÙŠØ¯Ø¹Ù… WebGPU ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ù† ÙƒØ§Ù† Ù…ØªØ§Ø­Ù‹Ø§Ø› ÙˆØ¥Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ CPU.</p>

  </div>

  <!-- Ø§Ù„Ø®ÙŠØ§Ø± (Ø£): Ø§Ø³ØªØ®Ø¯Ø§Ù… CDN Ø£ÙˆÙ„ Ù…Ø±Ø©ØŒ Ø«Ù… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø± -->
  <script src="https://unpkg.com/@xenova/transformers@3.2.3"></script>
  <script>
  // =============== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ===============
  const els = {
    direction: document.getElementById('direction'),
    modelSelect: document.getElementById('modelSelect'),
    swapBtn: document.getElementById('swapBtn'),
    src: document.getElementById('src'),
    tgt: document.getElementById('tgt'),
    translateBtn: document.getElementById('translateBtn'),
    pasteBtn: document.getElementById('pasteBtn'),
    clearBtn: document.getElementById('clearBtn'),
    copyBtn: document.getElementById('copyBtn'),
    saveTxtBtn: document.getElementById('saveTxtBtn'),
    status: document.getElementById('status'),
    accel: document.getElementById('accel'),
    mode: document.getElementById('mode'),
    bar: document.getElementById('bar'),
    progressText: document.getElementById('progressText'),
    localBase: document.getElementById('localBase'),
    applyLocal: document.getElementById('applyLocal'),
  };

  // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙŠ LocalStorage
  const LOCAL_KEY = 'translator_local_base';
  els.localBase.value = localStorage.getItem(LOCAL_KEY) || '';

  function setStatus(msg){ els.status.textContent = msg; }
  function setMode(msg){ els.mode.textContent = msg; }
  function setProgress(ratio, text){ els.bar.style.width = `${Math.max(0, Math.min(1, ratio))*100}%`; els.progressText.textContent = text || '' }

  // Ø§Ù„ÙƒØ´Ù Ø¹Ù† WebGPU/CPU
  (async () => {
    let accel = 'CPU';
    try {
      if ('gpu' in navigator) accel = 'WebGPU';
      else if (navigator.userAgent.toLowerCase().includes('firefox')) accel = 'WASM/Threads';
    } catch {}
    els.accel.textContent = accel;
  })();

  // =============== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¹Ø¨Ø± transformers.js ===============
  const { pipeline, env } = window.transformers;

  // ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ¹Ø¯Ù… Ø·Ù„Ø¨ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
  env.allowLocalModels = true;         // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ù…Ø³Ø§Ø±Ø§Øª Ù…Ø­Ù„ÙŠØ©
  env.useBrowserCache = true;          // Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙÙŠ IndexedDB
  env.localModelPath = null;           // Ù†Ø¶Ø¨Ø·Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù„Ø¯ Ù…Ø­Ù„ÙŠ
  // Ù„ØªØ¬Ø±Ø¨Ø© Ø£ÙØ¶Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©:
  env.backends.onnx.wasm.numThreads = Math.max(2, navigator.hardwareConcurrency ? Math.floor(navigator.hardwareConcurrency/2) : 2);

  // Ø§Ù„ØªØ±Ø¬Ù…Ø© ENâ†’AR Ùˆ ARâ†’EN
  const MODEL_IDS = {
    'en-ar': 'Helsinki-NLP/opus-mt-en-ar',
    'ar-en': 'Helsinki-NLP/opus-mt-ar-en'
  };

  // Ø¥Ù† ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ø¬Ù„Ø¯ Ù…Ø­Ù„ÙŠØŒ Ù†Ø³ØªØ®Ø¯Ù…Ù‡ ÙƒØ£Ø³Ø§Ø³ Ù„Ù„Ù…Ø³Ø§Ø±Ø§Øª
  function applyLocalBase(){
    const base = (els.localBase.value || '').trim();
    if (base) {
      // Ù…Ø«Ø§Ù„: ./models/  â€” ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ù…Ø¬Ù„Ø¯ Ù„ÙƒÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ø§Ø³Ù… Ù†ÙØ³Ù‡ ÙˆÙŠØ¶Ù… Ù…Ù„ÙØ§Øª tokenizer/model
      env.localModelPath = base.replace(/\\/g, '/');
      localStorage.setItem(LOCAL_KEY, env.localModelPath);
      setStatus(`ØªÙ… Ø¶Ø¨Ø· Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ù„Ù†Ù…Ø§Ø°Ø¬: ${env.localModelPath}`);
    } else {
      env.localModelPath = null;
      localStorage.removeItem(LOCAL_KEY);
      setStatus('ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ†Ø²ÙŠÙ„ Ù…Ù† Ø§Ù„ÙˆÙŠØ¨ (Ø¥Ù† Ù…ØªØ§Ø­).');
    }
  }
  els.applyLocal.addEventListener('click', applyLocalBase);
  if (els.localBase.value) applyLocalBase();

  let translator = null; // Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ pipeline Ø­Ø³Ø¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡
  let currentModelKey = null;
  let busy = false;

  async function ensurePipeline(dirKey){
    if (translator && currentModelKey === dirKey) return translator;
    setMode('ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬â€¦');
    setProgress(0, '');

    // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¹Ø±Ù‘Ù Ø§Ù„ØµØ­ÙŠØ­
    const modelId = MODEL_IDS[dirKey];

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (hooks)
    const progressCallback = (data) => {
      // data: { status, loaded, total, name, file }
      if (!data) return;
      let ratio = 0;
      if (data.total) ratio = data.loaded / data.total;
      setProgress(ratio, `${data.status || 'ØªØ­Ù…ÙŠÙ„'} â€” ${data.name || data.file || ''}`);
    };

    translator = await pipeline('translation', modelId, { progress_callback: progressCallback });
    currentModelKey = dirKey;
    setMode(`Ø¬Ø§Ù‡Ø² â€” ${modelId}${env.localModelPath ? ' (Ù…Ø­Ù„ÙŠ)' : ' (CDN)'}`);
    setProgress(1, 'Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„');
    return translator;
  }

  async function doTranslate(){
    if (busy) return;
    const text = els.src.value.trim();
    if (!text){ setStatus('Ø§ÙƒØªØ¨ Ù†ØµÙ‹Ø§ Ù„Ù„ØªØ±Ø¬Ù…Ø©.'); return; }
    busy = true; els.translateBtn.disabled = true; setStatus('Ø¬Ø§Ø±Ù Ø§Ù„ØªØ±Ø¬Ù…Ø©â€¦');

    const dirKey = els.direction.value;
    try {
      const pipe = await ensurePipeline(dirKey);
      // Ø¨Ø¹Ø¶ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªØ±Ø¬Ù…Ø© ØªØ¹Ù…Ù„ Ø¬ÙŠØ¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø¯ÙØ¹Ø§Øª â€” Ù†Ù‚Ø³Ù… Ø§Ù„Ù†Øµ Ø§Ù„Ø·ÙˆÙŠÙ„ ÙÙ‚Ø±Ø§Øª
      const parts = text.split(/\n{2,}/).map(s => s.trim()).filter(Boolean);
      const outputs = [];
      for (const part of (parts.length ? parts : [text])){
        const out = await pipe(part);
        // API ØªØ¹ÙŠØ¯ ÙƒØ§Ø¦Ù†Ù‹Ø§ Ø£Ùˆ Ù…ØµÙÙˆÙØ© ÙƒØ§Ø¦Ù†Ø§Øª [ { translation_text } ]
        const translated = Array.isArray(out) ? out.map(o => o.translation_text).join('\n') : (out.translation_text || '');
        outputs.push(translated);
      }
      els.tgt.value = outputs.join('\n\n');
      setStatus('ØªÙ…Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­.');
    } catch (err){
      console.error(err);
      setStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ±Ø¬Ù…Ø©: ' + (err && err.message ? err.message : err));
    } finally {
      busy = false; els.translateBtn.disabled = false;
    }
  }

  // Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ø¬Ù‡Ø©
  els.translateBtn.addEventListener('click', doTranslate);
  els.src.addEventListener('keydown', (e)=>{ if ((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='enter') doTranslate(); });

  els.pasteBtn.addEventListener('click', async ()=>{
    try{ els.src.value = await navigator.clipboard.readText(); }catch{ setStatus('Ù„Ù… Ø£Ø³ØªØ·Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©. Ø§Ø³Ù…Ø­ Ù„Ù„Ø£Ø°Ù† Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­.'); }
  });
  els.clearBtn.addEventListener('click', ()=>{ els.src.value=''; els.tgt.value=''; setStatus(''); });
  els.copyBtn.addEventListener('click', async ()=>{
    try{ await navigator.clipboard.writeText(els.tgt.value); setStatus('ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªØ±Ø¬Ù…Ø©.'); }catch{ setStatus('ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ù†Ø³Ø® Ù„Ù„Ø­Ø§ÙØ¸Ø©.'); }
  });
  els.saveTxtBtn.addEventListener('click', ()=>{
    const blob = new Blob([els.tgt.value||''], {type:'text/plain;charset=utf-8'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'translation.txt';
    a.click();
    URL.revokeObjectURL(a.href);
  });

  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¨Ø³Ø±Ø¹Ø©
  function syncModelSelect(){ els.modelSelect.value = els.direction.value; }
  els.direction.addEventListener('change', ()=>{ syncModelSelect(); setStatus('ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡.'); });
  els.swapBtn.addEventListener('click', ()=>{
    els.direction.value = (els.direction.value === 'en-ar') ? 'ar-en' : 'en-ar';
    syncModelSelect(); setStatus('ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„.');
  });
  els.modelSelect.addEventListener('change', ()=>{
    // Ø¶Ø¨Ø· Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù„ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    els.direction.value = els.modelSelect.value; setStatus('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù†Ù…ÙˆØ°Ø¬ Ù…Ø®ØªÙ„Ù â€” Ù‚Ø¯ ÙŠØ³ØªÙ„Ø²Ù… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„.');
    translator = null; currentModelKey = null; // Ù„Ø¶Ù…Ø§Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
  });

  // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ
  syncModelSelect();
  ensurePipeline(els.direction.value).catch(console.error);
  </script>
</body>
</html>
